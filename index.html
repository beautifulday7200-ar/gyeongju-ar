<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ì£¼ ë¬¸í™”ì¬ AR ì²´í—˜</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
            overflow: hidden;
            background: #f8f9fa;
        }

        /* ì‹œì‘ í™”ë©´ */
        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .start-content {
            background: white;
            border-radius: 30px;
            padding: 50px 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .start-content h1 {
            color: #667eea;
            font-size: 36px;
            margin-bottom: 12px;
            text-align: center;
            font-weight: 700;
        }

        .start-content .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 18px;
            line-height: 1.6;
        }

        .features {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .features h3 {
            color: #667eea;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }

        .feature-item:last-child {
            border-bottom: none;
        }

        .feature-icon {
            font-size: 24px;
        }

        .feature-text {
            color: #333;
            font-size: 15px;
        }

        .marker-info {
            background: #fff3cd;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
        }

        .marker-info p {
            color: #856404;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .marker-images {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .marker-box {
            text-align: center;
        }

        .marker-img {
            width: 100px;
            height: 100px;
            border: 3px solid #667eea;
            border-radius: 12px;
            background: white;
            padding: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .marker-label {
            margin-top: 8px;
            font-size: 13px;
            color: #667eea;
            font-weight: 600;
        }

        #start-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
        }

        #start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(102, 126, 234, 0.6);
        }

        #start-btn:active {
            transform: translateY(0);
        }

        /* AR ì»¨íŠ¸ë¡¤ UI */
        #ar-ui {
            display: none;
        }

        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7), transparent);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            animation: pulse 2s infinite;
        }

        .status-dot.active {
            background: #44ff44;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .status-text {
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .control-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 28px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:active {
            transform: scale(0.9);
        }

        .control-btn:hover {
            background: rgba(102, 126, 234, 0.9);
            transform: scale(1.1);
        }

        /* ì •ë³´ íŒ¨ë„ */
        #info-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.85));
            backdrop-filter: blur(20px);
            color: white;
            padding: 30px 25px;
            z-index: 100;
            display: none;
            animation: slideUp 0.4s ease-out;
            border-top: 3px solid #FFD700;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        #info-panel h3 {
            font-size: 26px;
            margin-bottom: 12px;
            color: #FFD700;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
        }

        #info-panel p {
            line-height: 1.8;
            margin-bottom: 20px;
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
        }

        .info-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .info-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 15px;
            color: white;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .info-btn:active {
            transform: scale(0.95);
        }

        .btn-quiz {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-audio {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn-close {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            color: white;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        /* í€´ì¦ˆ ëª¨ë‹¬ */
        #quiz-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 300;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .quiz-container {
            background: white;
            border-radius: 25px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .quiz-container h3 {
            color: #667eea;
            font-size: 28px;
            text-align: center;
            margin-bottom: 25px;
        }

        .quiz-question {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .quiz-option {
            width: 100%;
            padding: 18px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            text-align: left;
        }

        .quiz-option:hover:not(:disabled) {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateX(8px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .quiz-option.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
            font-weight: 600;
        }

        .quiz-option.wrong {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .quiz-result {
            margin-top: 25px;
            padding: 25px;
            border-radius: 15px;
            display: none;
        }

        .result-correct {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 3px solid #28a745;
        }

        .result-wrong {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 3px solid #dc3545;
        }

        .quiz-result h4 {
            font-size: 24px;
            margin-bottom: 12px;
        }

        .modal-close-btn {
            width: 100%;
            padding: 16px;
            margin-top: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        /* ìŠ¤í¬ë¦°ìƒ· ëª¨ë‹¬ */
        #screenshot-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 400;
            padding: 20px;
        }

        .screenshot-container {
            background: white;
            border-radius: 25px;
            padding: 35px;
            max-width: 550px;
            width: 100%;
            text-align: center;
        }

        .screenshot-container h3 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 20px;
        }

        #screenshot-preview {
            width: 100%;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .screenshot-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .screenshot-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 15px;
            color: white;
            transition: all 0.3s;
        }

        .btn-download {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-share {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .start-content {
                padding: 25px;
            }

            .start-content h1 {
                font-size: 26px;
            }

            .marker-img {
                width: 80px;
                height: 80px;
            }

            .control-buttons {
                top: 15px;
                right: 15px;
            }

            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }

            #info-panel {
                padding: 20px;
            }

            .quiz-container {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="start-screen">
        <div class="start-content">
            <h1>ğŸ›ï¸ ê²½ì£¼ ë¬¸í™”ì¬ AR</h1>
            <p class="subtitle">ì¦ê°•í˜„ì‹¤ë¡œ ë§Œë‚˜ëŠ” ì‹ ë¼ì˜ ì—­ì‚¬</p>

            <div class="features">
                <h3>âœ¨ ì²´í—˜ ê¸°ëŠ¥</h3>
                <div class="feature-item">
                    <span class="feature-icon">ğŸ¯</span>
                    <span class="feature-text">ë§ˆì»¤ ì¸ì‹ìœ¼ë¡œ 3D ë¬¸í™”ì¬ í‘œì‹œ</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">ğŸ“¸</span>
                    <span class="feature-text">AR ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜ & ê³µìœ </span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">ğŸ“</span>
                    <span class="feature-text">ë¬¸í™”ì¬ í€´ì¦ˆ & ìŒì„± í•´ì„¤</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">ğŸ“</span>
                    <span class="feature-text">ì‹¤ì‹œê°„ ê±°ë¦¬ ì¸¡ì •</span>
                </div>
            </div>

            <div class="marker-info">
                <p><strong>ğŸ“Œ ë§ˆì»¤ë¥¼ ì¤€ë¹„í•´ì£¼ì„¸ìš”!</strong><br>
                ì•„ë˜ ë§ˆì»¤ë¥¼ ì¶œë ¥í•˜ê±°ë‚˜ ë‹¤ë¥¸ í™”ë©´ì— ë„ì›Œì£¼ì„¸ìš”</p>
                <div class="marker-images">
                    <div class="marker-box">
                        <img class="marker-img" src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" alt="Hiro">
                        <div class="marker-label">ì²¨ì„±ëŒ€</div>
                    </div>
                    <div class="marker-box">
                        <img class="marker-img" src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/kanji.png" alt="Kanji">
                        <div class="marker-label">ë™ê¶ê³¼ ì›”ì§€</div>
                    </div>
                </div>
            </div>

            <button id="start-btn" onclick="startAR()">ğŸš€ AR ì²´í—˜ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <!-- AR ì¥ë©´ -->
    <a-scene
        id="ar-scene"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: high; antialias: true;"
        style="display: none;">
        
        <a-entity camera id="ar-camera"></a-entity>

        <!-- ì²¨ì„±ëŒ€ (Hiro ë§ˆì»¤) -->
<a-entity>
    <gltf-model
        src="https://raw.githubusercontent.com/beautifulday7200-ar/gyeongju-ar/main/models/scene.glb"
        scale="0.5 0.5 0.5"
        position="0 0 0"
        rotation="0 0 0">
    </gltf-model>
</a-entity>

        <!-- ë™ê¶ê³¼ ì›”ì§€ (Kanji ë§ˆì»¤) -->
        <a-marker preset="kanji" id="marker-donggung" emitevents="true">
            <a-entity id="model-donggung">
                <!-- ì—°ëª» -->
                <a-cylinder 
                    color="#4ECDC4" 
                    height="0.05" 
                    radius="0.7"
                    position="0 0 0"
                    opacity="0.8"
                    metalness="0.3"
                    roughness="0.2">
                </a-cylinder>
                
                <!-- ê±´ë¬¼ -->
                <a-entity animation="property: rotation; to: 0 360 0; loop: true; dur: 25000; easing: linear">
                    <a-box 
                        color="#DC143C" 
                        width="0.8" 
                        height="0.5" 
                        depth="0.6"
                        position="0 0.5 0"
                        shadow="cast: true">
                    </a-box>
                    
                    <!-- ì§€ë¶• -->
                    <a-cone 
                        color="#8B4513" 
                        radius-bottom="0.6" 
                        radius-top="0.1"
                        height="0.3"
                        position="0 0.9 0">
                    </a-cone>
                    
                    <!-- ì°½ë¬¸ -->
                    <a-box color="#FFD700" width="0.2" height="0.25" depth="0.05" position="0.25 0.45 0.31"></a-box>
                    <a-box color="#FFD700" width="0.2" height="0.25" depth="0.05" position="-0.25 0.45 0.31"></a-box>
                </a-entity>
                
                <!-- ë‹¬ -->
                <a-sphere 
                    color="#FFFACD" 
                    radius="0.12"
                    position="0.8 1.2 0"
                    animation="property: position; to: 0.8 1.3 0; dir: alternate; loop: true; dur: 2000; easing: easeInOutQuad">
                </a-sphere>
                <a-light type="point" color="#FFFACD" intensity="0.4" position="0.8 1.2 0"></a-light>
                
                <a-text 
                    value="ë™ê¶ê³¼ ì›”ì§€" 
                    color="#FFD700" 
                    align="center" 
                    position="0 1.5 0"
                    scale="0.6 0.6 0.6"
                    shader="msdf"
                    font="https://cdn.aframe.io/examples/ui/Viga-Regular.json">
                </a-text>
            </a-entity>
        </a-marker>

        <!-- í™˜ê²½ ì¡°ëª… -->
        <!-- í™˜ê²½ ì¡°ëª… ê°•í™” -->
        <a-light type="ambient" color="#FFF" intensity="0.6"></a-light>
        <a-light type="directional" color="#FFF" intensity="0.9" position="-2 3 1" 
                 shadow="cast: true; shadowCameraVisible: false"></a-light>
        <a-light type="directional" color="#FFA500" intensity="0.4" position="2 2 -1"></a-light>
    </a-scene>

    <!-- AR UI -->
    <div id="ar-ui">
        <div class="top-bar">
            <div class="status-indicator">
                <div class="status-dot" id="status-dot"></div>
                <span class="status-text" id="status-text">ë§ˆì»¤ë¥¼ ì°¾ëŠ” ì¤‘...</span>
            </div>
        </div>

        <div class="control-buttons">
            <button class="control-btn" onclick="takeScreenshot()" title="ìŠ¤í¬ë¦°ìƒ·">ğŸ“¸</button>
            <button class="control-btn" onclick="openQuiz()" title="í€´ì¦ˆ">ğŸ¯</button>
            <button class="control-btn" id="distance-btn" onclick="toggleDistance()" title="ê±°ë¦¬ ì¸¡ì •">ğŸ“</button>
        </div>
    </div>

    <!-- ì •ë³´ íŒ¨ë„ -->
    <div id="info-panel">
        <h3 id="heritage-name"></h3>
        <p id="heritage-description"></p>
        <div class="info-actions">
            <button class="info-btn btn-quiz" onclick="startQuiz()">ğŸ¯ í€´ì¦ˆ í’€ê¸°</button>
            <button class="info-btn btn-audio" onclick="playAudio()">ğŸ”Š ìŒì„± í•´ì„¤</button>
        </div>
        <button class="btn-close" onclick="closeInfo()">ë‹«ê¸°</button>
    </div>

    <!-- í€´ì¦ˆ ëª¨ë‹¬ -->
    <div id="quiz-modal">
        <div class="quiz-container">
            <h3>ğŸ¯ ë¬¸í™”ì¬ í€´ì¦ˆ</h3>
            <div class="quiz-question" id="quiz-question"></div>
            <div id="quiz-options"></div>
            <div id="quiz-result" class="quiz-result"></div>
            <button class="modal-close-btn" onclick="closeQuiz()">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦°ìƒ· ëª¨ë‹¬ -->
    <div id="screenshot-modal">
        <div class="screenshot-container">
            <h3>ğŸ“¸ AR ìŠ¤í¬ë¦°ìƒ·</h3>
            <img id="screenshot-preview" src="" alt="ìŠ¤í¬ë¦°ìƒ·">
            <div class="screenshot-buttons">
                <button class="screenshot-btn btn-download" onclick="downloadScreenshot()">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
                <button class="screenshot-btn btn-share" onclick="shareScreenshot()">ğŸ“¤ ê³µìœ í•˜ê¸°</button>
            </div>
            <button class="modal-close-btn" onclick="closeScreenshot()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        const heritageData = {
            'cheomseongdae': {
                name: 'ì²¨ì„±ëŒ€ (ç»æ˜Ÿè‡º)',
                description: 'êµ­ë³´ ì œ31í˜¸. ì‹ ë¼ ì„ ë•ì—¬ì™• ë•Œ ê±´ë¦½ëœ ë™ì–‘ì—ì„œ ê°€ì¥ ì˜¤ë˜ëœ ì²œë¬¸ ê´€ì¸¡ëŒ€ì…ë‹ˆë‹¤. ë†’ì´ 9.17m, 362ê°œì˜ ëŒë¡œ ìŒ“ì•„ì˜¬ë ¸ìœ¼ë©°, 1ë…„ 365ì¼ì„ ìƒì§•í•©ë‹ˆë‹¤.',
                audio: 'ì²¨ì„±ëŒ€ëŠ” ì‹ ë¼ ì„ ë•ì—¬ì™• ì‹œëŒ€ì— ë§Œë“¤ì–´ì§„ ì²œë¬¸ëŒ€ë¡œ, ë³„ì„ ê´€ì¸¡í•˜ì—¬ ë†ì‚¬ì™€ êµ­ê°€ì˜ ì¤‘ìš”í•œ ì¼ë“¤ì„ ê²°ì •í•˜ëŠ”ë° ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.'
            },
            'donggung': {
                name: 'ë™ê¶ê³¼ ì›”ì§€ (ì•ˆì••ì§€)',
                description: 'ì‚¬ì  ì œ18í˜¸. ì‹ ë¼ ë¬¸ë¬´ì™• 14ë…„(674ë…„)ì— ì¶•ì¡°ëœ ì™•ê¶ì˜ ë³„ê¶í„°ì…ë‹ˆë‹¤. ë‹¬ë¹›ì´ ë¹„ì¹˜ëŠ” ì•„ë¦„ë‹¤ìš´ ì—°ëª»ìœ¼ë¡œ ìœ ëª…í•˜ë©°, ë§ì€ ìœ ë¬¼ì´ ì¶œí† ë˜ì—ˆìŠµë‹ˆë‹¤.',
                audio: 'ë™ê¶ê³¼ ì›”ì§€ëŠ” ì‹ ë¼ ì™•ì¡±ë“¤ì´ íœ´ì‹ì„ ì·¨í•˜ê³  ì—°íšŒë¥¼ ì—´ë˜ ê³³ìœ¼ë¡œ, ì•„ë¦„ë‹¤ìš´ ì •ì›ê³¼ ì—°ëª»ì´ ì–´ìš°ëŸ¬ì§„ ë³„ê¶ì…ë‹ˆë‹¤.'
            }
        };

        const quizData = {
            'cheomseongdae': {
                question: 'ì²¨ì„±ëŒ€ëŠ” ëˆ„êµ¬ì˜ í†µì¹˜ ì‹œê¸°ì— ê±´ë¦½ë˜ì—ˆì„ê¹Œìš”?',
                options: ['ì‹ ë¼ ì„ ë•ì—¬ì™•', 'ì‹ ë¼ ì§„í¥ì™•', 'ì‹ ë¼ ë¬¸ë¬´ì™•', 'ì‹ ë¼ íƒœì¢…ë¬´ì—´ì™•'],
                correct: 0,
                explanation: 'ì²¨ì„±ëŒ€ëŠ” ì‹ ë¼ ì„ ë•ì—¬ì™•(ì¬ìœ„ 632-647) ì‹œê¸°ì— ê±´ë¦½ëœ ì²œë¬¸ ê´€ì¸¡ ì‹œì„¤ì…ë‹ˆë‹¤.'
            },
            'donggung': {
                question: 'ë™ê¶ê³¼ ì›”ì§€ì˜ ì˜› ì´ë¦„ì€ ë¬´ì—‡ì¼ê¹Œìš”?',
                options: ['ì„œì¶œì§€', 'ì•ˆì••ì§€', 'í¬ì„ì •', 'ë™ë¦¬ì§€'],
                correct: 1,
                explanation: 'ë™ê¶ê³¼ ì›”ì§€ëŠ” ì˜¤ë«ë™ì•ˆ ì•ˆì••ì§€ë¼ê³  ë¶ˆë ¸ìœ¼ë‚˜, ìµœê·¼ ì •ì‹ ëª…ì¹­ì´ ë™ê¶ê³¼ ì›”ì§€ë¡œ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'
            }
        };

        let currentMarker = null;
        let distanceTracking = false;
        let currentScreenshot = null;

        function startAR() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('ar-scene').style.display = 'block';
            document.getElementById('ar-ui').style.display = 'block';
        }

        function showInfo(markerId) {
            const heritage = markerId.replace('marker-', '');
            const info = heritageData[heritage];
            
            if (info) {
                document.getElementById('heritage-name').textContent = info.name;
                document.getElementById('heritage-description').textContent = info.description;
                document.getElementById('info-panel').style.display = 'block';
            }
        }

        function closeInfo() {
            document.getElementById('info-panel').style.display = 'none';
        }

        function startQuiz() {
            if (!currentMarker) return;
            closeInfo();
            const quiz = quizData[currentMarker];
            
            document.getElementById('quiz-question').textContent = quiz.question;
            
            const optionsHtml = quiz.options.map((option, index) => 
                `<button class="quiz-option" onclick="checkAnswer(${index})">${option}</button>`
            ).join('');
            
            document.getElementById('quiz-options').innerHTML = optionsHtml;
            document.getElementById('quiz-result').style.display = 'none';
            document.getElementById('quiz-modal').style.display = 'flex';
        }

        function openQuiz() {
            if (!currentMarker) {
                alert('ë¨¼ì € ë§ˆì»¤ë¥¼ ì¸ì‹í•´ì£¼ì„¸ìš”!');
                return;
            }
            startQuiz();
        }

        function checkAnswer(selected) {
            const quiz = quizData[currentMarker];
            const resultDiv = document.getElementById('quiz-result');
            const options = document.querySelectorAll('.quiz-option');
            
            options.forEach(btn => btn.disabled = true);
            
            if (selected === quiz.correct) {
                resultDiv.innerHTML = `<h4>ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</h4><p>${quiz.explanation}</p>`;
                resultDiv.className = 'quiz-result result-correct';
                options[selected].classList.add('correct');
            } else {
                resultDiv.innerHTML = `<h4>ğŸ˜¢ ì•„ì‰½ë„¤ìš”!</h4><p>ì •ë‹µì€ <strong>${quiz.options[quiz.correct]}</strong>ì…ë‹ˆë‹¤.</p><p>${quiz.explanation}</p>`;
                resultDiv.className = 'quiz-result result-wrong';
                options[selected].classList.add('wrong');
                options[quiz.correct].classList.add('correct');
            }
            
            resultDiv.style.display = 'block';
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').style.display = 'none';
        }

        function playAudio() {
            if (!currentMarker) return;
            
            const info = heritageData[currentMarker];
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(info.audio);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            } else {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± í•´ì„¤ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        function takeScreenshot() {
            const scene = document.querySelector('a-scene');
            
            // rendererê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°
            if (!scene || !scene.renderer) {
                alert('AR ì¥ë©´ì´ ì•„ì§ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const canvas = scene.renderer.domElement;
                
                canvas.toBlob(function(blob) {
                    if (!blob) {
                        alert('ìŠ¤í¬ë¦°ìƒ·ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    const url = URL.createObjectURL(blob);
                    currentScreenshot = url;
                    document.getElementById('screenshot-preview').src = url;
                    document.getElementById('screenshot-modal').style.display = 'flex';
                });
            } catch (error) {
                console.error('ìŠ¤í¬ë¦°ìƒ· ì—ëŸ¬:', error);
                alert('ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function downloadScreenshot() {
            if (!currentScreenshot) return;
            
            const link = document.createElement('a');
            link.download = `ê²½ì£¼AR_${new Date().getTime()}.png`;
            link.href = currentScreenshot;
            link.click();
        }

        function shareScreenshot() {
            if (navigator.share) {
                fetch(currentScreenshot)
                    .then(res => res.blob())
                    .then(blob => {
                        const file = new File([blob], 'gyeongju-ar.png', { type: 'image/png' });
                        navigator.share({
                            files: [file],
                            title: 'ê²½ì£¼ ë¬¸í™”ì¬ AR ì²´í—˜',
                            text: 'ì¦ê°•í˜„ì‹¤ë¡œ ê²½ì£¼ ë¬¸í™”ì¬ë¥¼ ì²´í—˜í–ˆì–´ìš”!'
                        });
                    })
                    .catch(() => {
                        alert('ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    });
            } else {
                alert('ì´ ê¸°ê¸°ì—ì„œëŠ” ê³µìœ  ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        function closeScreenshot() {
            document.getElementById('screenshot-modal').style.display = 'none';
        }

        function toggleDistance() {
            distanceTracking = !distanceTracking;
            const btn = document.getElementById('distance-btn');
            
            if (distanceTracking) {
                btn.style.background = 'rgba(68, 255, 68, 0.8)';
            } else {
                btn.style.background = 'rgba(0, 0, 0, 0.8)';
            }
        }

        window.addEventListener('load', function() {
            const markers = ['cheomseongdae', 'donggung'];
            
            markers.forEach(markerName => {
                const marker = document.getElementById('marker-' + markerName);
                
                marker.addEventListener('markerFound', function() {
                    currentMarker = markerName;
                    document.getElementById('status-text').textContent = 
                        heritageData[markerName].name + ' ì¸ì‹ë¨!';
                    document.getElementById('status-dot').classList.add('active');
                    
                    setTimeout(() => {
                        showInfo('marker-' + markerName);
                    }, 1000);
                });
                
                marker.addEventListener('markerLost', function() {
                    if (currentMarker === markerName) {
                        currentMarker = null;
                        document.getElementById('status-text').textContent = 'ë§ˆì»¤ë¥¼ ì°¾ëŠ” ì¤‘...';
                        document.getElementById('status-dot').classList.remove('active');
                        closeInfo();
                    }
                });
            });
        });
    </script>
</body>
</html>
